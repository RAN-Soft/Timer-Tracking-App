{% extends "templates/web.html" %}

{% block head %}
  {{ super() }}

  <link rel="stylesheet" href="/assets/time_tracking_app/css/time-tracking.css">

  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no"
  />
  <title>Time Tracking</title>

  <!-- PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Time Tracking" />
  <meta name="apple-mobile-web-app-status-bar-style" content="white" />
  <meta name="theme-color" content="#1f4f7b" />

  <link
    rel="icon"
    type="image/png"
    sizes="196x196"
    href="/assets/time_tracking_app/icons/icon-192.png"
  />
  <link
    rel="apple-touch-icon"
    href="/assets/time_tracking_app/icons/icon-192.png"
  />

  <link rel="manifest" href="/assets/time_tracking_app/manifest.json" />

  
  <style>
    /* Nur linke Navbar-Seite ausblenden */
    header.navbar .navbar-brand {
    display: none !important;
    }

    /* Footer weiterhin ausblenden */
    footer.web-footer,
    .page-footer {
    display: none !important;
    }

    /* Seite nach oben ziehen */
    .page-content-wrapper {
    margin-top: 0 !important;
    }

    /* Content über die volle Höhe */
    .page-content-wrapper {
      margin-top: 0 !important;
    }
  </style>
{% endblock %}

{% block page_content %}

  {# Wenn Gast → sofort auf Login umleiten und GAR NICHTS rendern #}
  {% if frappe.session.user == "Guest" %}
    <script>
      window.location.href = "/login?redirect-to=/time-tracking";
    </script>
  {% else %}

    <div id="app"></div>

    <script>
      // Boot-Kontext von Python
      window.csrf_token = "{{ csrf_token }}";
      window.site_name = "{{ site_name }}";

      if (!window.frappe) window.frappe = {};
      frappe.boot = {{ boot }};
    </script>

    <!-- Vue-Bundle -->
    <script
      type="module"
      src="/assets/time_tracking_app/frontend/assets/index.js"
    ></script>

    <!-- Service Worker Registrierung -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/assets/time_tracking_app/js/service_worker.js")
            .catch((err) => console.error("SW registration failed", err));
        });
      }
    </script>

  {% endif %}

{% endblock %}
