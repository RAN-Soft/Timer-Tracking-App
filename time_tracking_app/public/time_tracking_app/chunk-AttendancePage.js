import{d as P,r as u,o as z,i as F,j as r,w as t,u as e,I as U,a4 as V,a5 as H,k as a,l as K,m as $,n as o,W as j,E as S,X as G,Y as J,G as d,p as W,K as h,H as D,z as f,Z as X,_ as Y,A as c,$ as Z,C as w,y as k,a6 as q,D as Q,F as R,J as ee,S as i,U as v,a7 as ne,a8 as te}from"./app.js";import{S as ae}from"./chunk-SyncStatusBar.js";import{u as se,l as le}from"./chunk-userAvatar.js";const oe={key:0},ie={key:0},ue=P({__name:"AttendancePage",setup(re){const _=u([]),I=u([]),m=u(!1),g=u(navigator.onLine),p=u(!1),b=u(""),{userInitials:E,avatarColor:M,loadUserInitials:O}=se();function x(s){b.value=s,p.value=!0}function y(s){const n=L.value.get(s);return n?n.log_type==="IN":!1}const L=u(new Map);function T(){const s=new Map;for(const n of I.value){const l=s.get(n.employee);if(!l){s.set(n.employee,n);continue}n.time>l.time&&s.set(n.employee,n)}L.value=s}async function A(){m.value=!0;try{const[s,n]=await Promise.all([V(),H()]);_.value=s,I.value=n,T()}catch(s){console.error("Failed to load attendance",s),x(s?.message||"Fehler beim Laden der Anwesenheit.")}finally{m.value=!1}}async function N(){await le()}function C(){g.value=!0}function B(){g.value=!1}return z(async()=>{await O(),await A(),window.addEventListener("online",C),window.addEventListener("offline",B)}),F(()=>{window.removeEventListener("online",C),window.removeEventListener("offline",B)}),(s,n)=>(i(),r(e(U),null,{default:t(()=>[a(e(W),null,{default:t(()=>[a(e(K),{color:"primary"},{default:t(()=>[a(e($),null,{default:t(()=>[...n[1]||(n[1]=[o("Anwesenheit",-1)])]),_:1}),a(e(j),{slot:"end"},{default:t(()=>[a(e(S),{id:"user-avatar-btn-attendance"},{default:t(()=>[a(e(G),{class:"avatar-bubble",style:J({background:e(M)})},{default:t(()=>[o(d(e(E)),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),a(e(Z),{trigger:"user-avatar-btn-attendance","trigger-action":"click"},{default:t(()=>[a(e(h),null,{default:t(()=>[a(e(D),null,{default:t(()=>[a(e(f),{button:"",onClick:N},{default:t(()=>[a(e(X),{slot:"start",icon:e(Y)},null,8,["icon"]),a(e(c),null,{default:t(()=>[...n[2]||(n[2]=[o("Abmelden",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(e(h),{class:"ion-padding"},{default:t(()=>[a(ae),a(e(f),{lines:"none"},{default:t(()=>[a(e(c),{color:"medium"},{default:t(()=>[n[3]||(n[3]=o(" Die Anwesenheitsliste wird aus den heutigen Checkins berechnet. ",-1)),g.value?k("",!0):(i(),w("div",oe," Du bist offline – Daten können veraltet sein. "))]),_:1}),a(e(S),{slot:"end",size:"small",disabled:m.value,onClick:A},{default:t(()=>[...n[4]||(n[4]=[o(" Aktualisieren ",-1)])]),_:1},8,["disabled"])]),_:1}),m.value?(i(),r(e(f),{key:0,lines:"none"},{default:t(()=>[a(e(c),null,{default:t(()=>[...n[5]||(n[5]=[o("Lade Anwesenheit…",-1)])]),_:1}),a(e(q),{slot:"end"})]),_:1})):(i(),r(e(D),{key:1},{default:t(()=>[(i(!0),w(R,null,Q(_.value,l=>(i(),r(e(f),{key:l.name},{default:t(()=>[v("div",{slot:"start",class:ne(["status-dot",{"status-online":y(l.name),"status-offline":!y(l.name)}])},null,2),a(e(c),null,{default:t(()=>[v("h2",null,[o(d(l.first_name||"")+" "+d(l.last_name||"")+" ",1),!l.first_name&&!l.last_name?(i(),w("span",ie,d(l.employee_name||l.name),1)):k("",!0)]),v("p",null,[n[6]||(n[6]=o(" Status: ",-1)),v("strong",null,d(y(l.name)?"Anwesend":"Abwesend"),1)])]),_:2},1024)]),_:2},1024))),128)),_.value.length===0?(i(),r(e(f),{key:0},{default:t(()=>[a(e(c),{color:"medium"},{default:t(()=>[...n[7]||(n[7]=[o(" Keine Mitarbeiter gefunden. ",-1)])]),_:1})]),_:1})):k("",!0)]),_:1})),a(e(ee),{"is-open":p.value,message:b.value,duration:3e3,onDidDismiss:n[0]||(n[0]=l=>p.value=!1)},null,8,["is-open","message"])]),_:1})]),_:1}))}}),me=te(ue,[["__scopeId","data-v-67c9bc91"]]);export{me as default};
