import{d as T,r as u,o as z,i as F,j as r,w as t,u as e,I as V,a3 as U,a4 as H,k as a,l as j,m as q,n as o,p as G,q as O,t as K,v as R,x as d,y as X,z as S,A as h,B as f,C as $,D as J,E as c,F as Q,G as w,H as k,O as W,R as Y,P as Z,S as ee,X as i,N as v,a5 as ne,_ as te}from"./app.js";import{u as ae,S as se,l as le}from"./chunk-userAvatar.js";const oe={key:0},ie={key:0},ue=T({__name:"AttendancePage",setup(re){const _=u([]),I=u([]),m=u(!1),g=u(navigator.onLine),y=u(!1),b=u(""),{userInitials:x,avatarColor:D,loadUserInitials:E}=ae();function M(s){b.value=s,y.value=!0}function p(s){const n=L.value.get(s);return n?n.log_type==="IN":!1}const L=u(new Map);function N(){const s=new Map;for(const n of I.value){const l=s.get(n.employee);if(!l){s.set(n.employee,n);continue}n.time>l.time&&s.set(n.employee,n)}L.value=s}async function A(){m.value=!0;try{const[s,n]=await Promise.all([U(),H()]);_.value=s,I.value=n,N()}catch(s){console.error("Failed to load attendance",s),M(s?.message||"Fehler beim Laden der Anwesenheit.")}finally{m.value=!1}}async function P(){await le()}function C(){g.value=!0}function B(){g.value=!1}return z(async()=>{await E(),await A(),window.addEventListener("online",C),window.addEventListener("offline",B)}),F(()=>{window.removeEventListener("online",C),window.removeEventListener("offline",B)}),(s,n)=>(i(),r(e(V),null,{default:t(()=>[a(e(X),null,{default:t(()=>[a(e(j),{color:"primary"},{default:t(()=>[a(e(q),null,{default:t(()=>[...n[1]||(n[1]=[o("Anwesenheit",-1)])]),_:1}),a(e(G),{slot:"end"},{default:t(()=>[a(e(O),{id:"user-avatar-btn-attendance"},{default:t(()=>[a(e(K),{class:"avatar-bubble",style:R({background:e(D)})},{default:t(()=>[o(d(e(x)),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),a(e(Q),{trigger:"user-avatar-btn-attendance","trigger-action":"click"},{default:t(()=>[a(e(S),null,{default:t(()=>[a(e(h),null,{default:t(()=>[a(e(f),{button:"",onClick:P},{default:t(()=>[a(e($),{slot:"start",icon:e(J)},null,8,["icon"]),a(e(c),null,{default:t(()=>[...n[2]||(n[2]=[o("Abmelden",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(e(S),{class:"ion-padding"},{default:t(()=>[a(se),a(e(f),{lines:"none"},{default:t(()=>[a(e(c),{color:"medium"},{default:t(()=>[n[3]||(n[3]=o(" Die Anwesenheitsliste wird aus den heutigen Checkins berechnet. ",-1)),g.value?k("",!0):(i(),w("div",oe," Du bist offline – Daten können veraltet sein. "))]),_:1}),a(e(O),{slot:"end",size:"small",disabled:m.value,onClick:A},{default:t(()=>[...n[4]||(n[4]=[o(" Aktualisieren ",-1)])]),_:1},8,["disabled"])]),_:1}),m.value?(i(),r(e(f),{key:0,lines:"none"},{default:t(()=>[a(e(c),null,{default:t(()=>[...n[5]||(n[5]=[o("Lade Anwesenheit…",-1)])]),_:1}),a(e(W),{slot:"end"})]),_:1})):(i(),r(e(h),{key:1},{default:t(()=>[(i(!0),w(Z,null,Y(_.value,l=>(i(),r(e(f),{key:l.name},{default:t(()=>[v("div",{slot:"start",class:ne(["status-dot",{"status-online":p(l.name),"status-offline":!p(l.name)}])},null,2),a(e(c),null,{default:t(()=>[v("h2",null,[o(d(l.first_name||"")+" "+d(l.last_name||"")+" ",1),!l.first_name&&!l.last_name?(i(),w("span",ie,d(l.employee_name||l.name),1)):k("",!0)]),v("p",null,[n[6]||(n[6]=o(" Status: ",-1)),v("strong",null,d(p(l.name)?"Anwesend":"Abwesend"),1)])]),_:2},1024)]),_:2},1024))),128)),_.value.length===0?(i(),r(e(f),{key:0},{default:t(()=>[a(e(c),{color:"medium"},{default:t(()=>[...n[7]||(n[7]=[o(" Keine Mitarbeiter gefunden. ",-1)])]),_:1})]),_:1})):k("",!0)]),_:1})),a(e(ee),{"is-open":y.value,message:b.value,duration:3e3,onDidDismiss:n[0]||(n[0]=l=>y.value=!1)},null,8,["is-open","message"])]),_:1})]),_:1}))}}),ce=te(ue,[["__scopeId","data-v-67c9bc91"]]);export{ce as default};
