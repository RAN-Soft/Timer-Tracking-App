import{r as d,d as N,o as P,h as V,a5 as z,a6 as F,q as U,t as v,w as n,u as e,I as H,v as t,x as $,y as q,z as i,Z as G,O as x,_ as K,$ as Q,P as y,A as R,S as D,Q as E,G as _,a0 as Z,a1 as j,H as p,a2 as J,L as O,F as B,a7 as W,M as X,N as Y,R as ee,T as u,V as k,a8 as ne}from"./app.js";import{S as te}from"./chunk-SyncStatusBar.js";import{u as ae,l as se}from"./chunk-userAvatar.js";function oe(){const I=d([]),f=d([]),r=d(!1),c=d(navigator.onLine),m=d(!1),w=d(""),{userInitials:b,avatarColor:L,loadUserInitials:A}=ae();function g(o){w.value=o,m.value=!0}const C=N(()=>{const o=new Map;for(const l of f.value){const T=o.get(l.employee);(!T||l.time>T.time)&&o.set(l.employee,l)}return o});function S(o){const l=C.value.get(o);return!!l&&l.log_type==="IN"}async function a(){r.value=!0;try{const[o,l]=await Promise.all([z(),F()]);I.value=o,f.value=l}catch(o){console.error("Failed to load attendance",o),g(o?.message||"Fehler beim Laden der Anwesenheit.")}finally{r.value=!1}}async function s(){await se()}function h(){c.value=!0}function M(){c.value=!1}return P(async()=>{await A(),await a(),window.addEventListener("online",h),window.addEventListener("offline",M)}),V(()=>{window.removeEventListener("online",h),window.removeEventListener("offline",M)}),{employees:I,loading:r,navigatorOnLine:c,toastOpen:m,toastMessage:w,userInitials:b,avatarColor:L,reload:a,isOnline:S,doLogout:s}}const le={key:0},ie={key:0},fe=U({__name:"AttendancePage",setup(I){const{employees:f,loading:r,navigatorOnLine:c,toastOpen:m,toastMessage:w,userInitials:b,avatarColor:L,reload:A,isOnline:g,doLogout:C}=oe();return(S,a)=>(u(),v(e(H),null,{default:n(()=>[t(e(R),null,{default:n(()=>[t(e($),{color:"primary"},{default:n(()=>[t(e(q),null,{default:n(()=>[...a[1]||(a[1]=[i("Anwesenheit",-1)])]),_:1}),t(e(G),{slot:"end"},{default:n(()=>[t(e(x),{id:"user-avatar-btn-attendance"},{default:n(()=>[t(e(K),{class:"avatar-bubble",style:Q({background:e(L)})},{default:n(()=>[i(y(e(b)),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(J),{trigger:"user-avatar-btn-attendance","trigger-action":"click"},{default:n(()=>[t(e(D),null,{default:n(()=>[t(e(E),null,{default:n(()=>[t(e(_),{button:"",onClick:e(C)},{default:n(()=>[t(e(Z),{slot:"start",icon:e(j)},null,8,["icon"]),t(e(p),null,{default:n(()=>[...a[2]||(a[2]=[i("Abmelden",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),t(e(D),{class:"ion-padding"},{default:n(()=>[t(te),t(e(_),{lines:"none"},{default:n(()=>[t(e(p),{color:"medium"},{default:n(()=>[a[3]||(a[3]=i(" Die Anwesenheitsliste wird aus den heutigen Checkins berechnet. ",-1)),e(c)?B("",!0):(u(),O("div",le," Du bist offline – Daten können veraltet sein. "))]),_:1}),t(e(x),{slot:"end",size:"small",disabled:e(r),onClick:e(A)},{default:n(()=>[...a[4]||(a[4]=[i(" Aktualisieren ",-1)])]),_:1},8,["disabled","onClick"])]),_:1}),e(r)?(u(),v(e(_),{key:0,lines:"none"},{default:n(()=>[t(e(p),null,{default:n(()=>[...a[5]||(a[5]=[i("Lade Anwesenheit…",-1)])]),_:1}),t(e(W),{slot:"end"})]),_:1})):(u(),v(e(E),{key:1},{default:n(()=>[(u(!0),O(Y,null,X(e(f),s=>(u(),v(e(_),{key:s.name},{default:n(()=>[k("div",{slot:"start",class:ne(["status-dot",{"status-online":e(g)(s.name),"status-offline":!e(g)(s.name)}])},null,2),t(e(p),null,{default:n(()=>[k("h2",null,[i(y(s.first_name||"")+" "+y(s.last_name||"")+" ",1),!s.first_name&&!s.last_name?(u(),O("span",ie,y(s.employee_name||s.name),1)):B("",!0)]),k("p",null,[a[6]||(a[6]=i(" Status: ",-1)),k("strong",null,y(e(g)(s.name)?"Anwesend":"Abwesend"),1)])]),_:2},1024)]),_:2},1024))),128)),e(f).length===0?(u(),v(e(_),{key:0},{default:n(()=>[t(e(p),{color:"medium"},{default:n(()=>[...a[7]||(a[7]=[i(" Keine Mitarbeiter gefunden. ",-1)])]),_:1})]),_:1})):B("",!0)]),_:1})),t(e(ee),{"is-open":e(m),message:e(w),duration:3e3,onDidDismiss:a[0]||(a[0]=s=>m.value=!1)},null,8,["is-open","message"])]),_:1})]),_:1}))}});export{fe as default};
