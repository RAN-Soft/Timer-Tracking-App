import{d as F,r as o,W as L,c as H,o as J,h as K,i as k,w as t,u as e,I as R,s as $,j as a,k as j,l as G,m as s,n as Q,p as T,q as W,t as X,v as E,x as Y,y as S,z as Z,A as y,B as h,C as ee,D as g,E as ae,H as ne,J as te,K as le,L as oe,G as se,X as D,P as ue,F as v,Q as re,O as ie,M as de,Y as ve,R as fe,Z as me,S as pe,_ as ye,$ as ge,U as u,V as ce}from"./app.js";import{u as be,S as Ie}from"./app10.js";const Le={key:0},_e={key:1},we={key:0},ke={key:1},Ue={key:0},Ve={key:1},Ee=F({__name:"LeavePage",setup(Ce){const r=o(""),i=o(""),d=o(""),f=o(""),m=o(!1),c=o(""),b=o(!1),p=o(L()),_=o(!1),w=o(navigator.onLine),U=H(()=>!!r.value&&!!i.value&&!!d.value),{userInitials:O,avatarColor:x,loadUserInitials:z,logout:A}=be();async function N(){if(p.value=L(),!(p.value.length>0)){if(!navigator.onLine){console.warn("Keine Urlaubstypen & offline → kann nichts laden");return}try{_.value=!0,await $(),p.value=L()}catch(I){console.error("ensureLeaveTypesLoaded error",I)}finally{_.value=!1}}}async function M(){if(!U.value||b.value)return;const I=r.value?.slice(0,10),n=i.value?.slice(0,10);if(!I||!n){c.value="Bitte gültige Daten auswählen.",m.value=!0;return}if(!navigator.onLine){me(r.value,i.value,d.value,f.value),c.value="Urlaubsantrag offline gespeichert (wird synchronisiert, sobald du online bist).",m.value=!0,pe(),r.value="",i.value="",d.value="",f.value="";return}b.value=!0;try{const q={employee:await ye(),from_date:I,to_date:n,leave_type:d.value,reason:f.value||void 0};await ge(q),c.value="Urlaubsantrag erfolgreich erstellt.",m.value=!0,r.value="",i.value="",d.value="",f.value=""}catch(l){console.error("Leave submit error",l),c.value=l?.message||"Fehler beim Erstellen des Urlaubsantrags.",m.value=!0}finally{b.value=!1}}async function P(){await A()}function V(){w.value=!0}function C(){w.value=!1}function B(){p.value=L()}return J(async()=>{await z(),await N(),window.addEventListener("online",V),window.addEventListener("offline",C),window.addEventListener("tta-sync-updated",B)}),K(()=>{window.removeEventListener("online",V),window.removeEventListener("offline",C),window.removeEventListener("tta-sync-updated",B)}),(I,n)=>(u(),k(e(R),null,{default:t(()=>[a(e(Y),null,{default:t(()=>[a(e(j),{color:"primary"},{default:t(()=>[a(e(G),null,{default:t(()=>[...n[5]||(n[5]=[s("Urlaub",-1)])]),_:1}),a(e(Q),{slot:"end"},{default:t(()=>[a(e(T),{id:"user-avatar-btn-leave"},{default:t(()=>[a(e(W),{class:"avatar-bubble",style:X({background:e(x)})},{default:t(()=>[s(E(e(O)),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),a(e(ae),{trigger:"user-avatar-btn-leave","trigger-action":"click"},{default:t(()=>[a(e(S),null,{default:t(()=>[a(e(Z),null,{default:t(()=>[a(e(y),{button:"",onClick:P},{default:t(()=>[a(e(h),{slot:"start",icon:e(ee)},null,8,["icon"]),a(e(g),null,{default:t(()=>[...n[6]||(n[6]=[s("Abmelden",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(e(S),{class:"ion-padding"},{default:t(()=>[a(Ie),a(e(ne),null,{default:t(()=>[a(e(te),null,{default:t(()=>[a(e(le),null,{default:t(()=>[...n[7]||(n[7]=[s("Urlaub beantragen",-1)])]),_:1})]),_:1}),a(e(oe),null,{default:t(()=>[a(e(y),null,{default:t(()=>[a(e(g),{position:"stacked"},{default:t(()=>[...n[8]||(n[8]=[s("Von",-1)])]),_:1}),a(e(D),{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=l=>r.value=l),presentation:"date"},null,8,["modelValue"])]),_:1}),a(e(y),null,{default:t(()=>[a(e(g),{position:"stacked"},{default:t(()=>[...n[9]||(n[9]=[s("Bis",-1)])]),_:1}),a(e(D),{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=l=>i.value=l),presentation:"date"},null,8,["modelValue"])]),_:1}),a(e(y),null,{default:t(()=>[a(e(g),{position:"stacked"},{default:t(()=>[...n[10]||(n[10]=[s("Urlaubstyp",-1)])]),_:1}),a(e(ue),{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l)},{default:t(()=>[(u(!0),v(ie,null,re(p.value,l=>(u(),k(e(ce),{key:l.id,value:l.name},{default:t(()=>[s(E(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p.value.length===0?(u(),k(e(y),{key:0},{default:t(()=>[a(e(g),{color:"medium"},{default:t(()=>[_.value?(u(),v("div",Le," Lade Urlaubstypen… ")):(u(),v("div",_e,[n[11]||(n[11]=s(" Es sind noch keine Urlaubstypen geladen. ",-1)),n[12]||(n[12]=de("br",null,null,-1)),w.value?(u(),v("span",ke," Tippe auf „Jetzt synchronisieren“, um Urlaubstypen zu laden. ")):(u(),v("span",we," Bitte verbinde dich einmal mit dem Internet und tippe auf „Jetzt synchronisieren“, um Urlaubstypen zu laden. "))]))]),_:1})]),_:1})):se("",!0),a(e(y),null,{default:t(()=>[a(e(g),{position:"stacked"},{default:t(()=>[...n[13]||(n[13]=[s("Kommentar",-1)])]),_:1}),a(e(ve),{modelValue:f.value,"onUpdate:modelValue":n[3]||(n[3]=l=>f.value=l),"auto-grow":""},null,8,["modelValue"])]),_:1}),a(e(T),{expand:"block",class:"ion-margin-top",disabled:!U.value||b.value,onClick:M},{default:t(()=>[b.value?(u(),v("span",Ue,"Sende…")):(u(),v("span",Ve,"Absenden"))]),_:1},8,["disabled"])]),_:1})]),_:1}),a(e(fe),{"is-open":m.value,message:c.value,duration:4e3,onDidDismiss:n[4]||(n[4]=l=>m.value=!1)},null,8,["is-open","message"])]),_:1})]),_:1}))}});export{Ee as default};
