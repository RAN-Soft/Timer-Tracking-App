import{r as u,W as U,d as H,o as J,h as K,s as $,X as G,i as Q,e as W,Y as X,q as Y,t as D,w as t,u as e,I as Z,v as a,x as j,y as h,z as r,Z as ee,O as M,_ as ae,$ as ne,P,A as te,S as R,Q as le,G as L,a0 as oe,a1 as se,H as I,a2 as ue,B as re,C as ie,D as de,E as ve,F as fe,a3 as q,K as V,J as me,L as m,M as pe,N as ye,V as ge,a4 as ce,R as be,T as i,U as Le}from"./app.js";import{S as Ie}from"./chunk-SyncStatusBar.js";import{u as _e}from"./chunk-userAvatar.js";function we(){const f=u(""),o=u(""),s=u(""),d=u(""),p=u(!1),_=u(""),y=u(!1),v=u(U()),g=u(!1),w=u(navigator.onLine),k=H(()=>!!f.value&&!!o.value&&!!s.value),{userInitials:C,avatarColor:T,loadUserInitials:B,logout:S}=_e();function c(b){_.value=b,p.value=!0}async function E(){if(v.value=U(),!(v.value.length>0)){if(!navigator.onLine){console.warn("Keine Urlaubstypen & offline → kann nichts laden");return}try{g.value=!0,await $(),v.value=U()}catch(b){console.error("ensureLeaveTypesLoaded error",b)}finally{g.value=!1}}}async function n(){if(!k.value||y.value)return;const b=f.value?.slice(0,10),N=o.value?.slice(0,10);if(!b||!N){c("Bitte gültige Daten auswählen.");return}if(!navigator.onLine){G(f.value,o.value,s.value,d.value),c("Urlaubsantrag offline gespeichert (wird synchronisiert, sobald du online bist)."),Q(),f.value="",o.value="",s.value="",d.value="";return}y.value=!0;try{const F={employee:await W(),from_date:b,to_date:N,leave_type:s.value,reason:d.value||void 0};await X(F),c("Urlaubsantrag erfolgreich erstellt."),f.value="",o.value="",s.value="",d.value=""}catch(O){console.error("Leave submit error",O),c(O?.message||"Fehler beim Erstellen des Urlaubsantrags.")}finally{y.value=!1}}async function l(){await S()}function x(){w.value=!0}function z(){w.value=!1}function A(){v.value=U()}return J(async()=>{await B(),await E(),window.addEventListener("online",x),window.addEventListener("offline",z),window.addEventListener("tta-sync-updated",A)}),K(()=>{window.removeEventListener("online",x),window.removeEventListener("offline",z),window.removeEventListener("tta-sync-updated",A)}),{from:f,to:o,type:s,reason:d,toastOpen:p,toastMessage:_,submitting:y,leaveTypes:v,loadingLeaveTypes:g,navigatorOnLine:w,canSubmit:k,userInitials:C,avatarColor:T,submit:n,doLogout:l,ensureLeaveTypesLoaded:E}}const ke={key:0},Ue={key:1},Ve={key:0},Ce={key:1},Te={key:0},Be={key:1},De=Y({__name:"LeavePage",setup(f){const{from:o,to:s,type:d,reason:p,toastOpen:_,toastMessage:y,submitting:v,leaveTypes:g,loadingLeaveTypes:w,navigatorOnLine:k,canSubmit:C,userInitials:T,avatarColor:B,submit:S,doLogout:c}=we();return(E,n)=>(i(),D(e(Z),null,{default:t(()=>[a(e(te),null,{default:t(()=>[a(e(j),{color:"primary"},{default:t(()=>[a(e(h),null,{default:t(()=>[...n[5]||(n[5]=[r("Urlaub",-1)])]),_:1}),a(e(ee),{slot:"end"},{default:t(()=>[a(e(M),{id:"user-avatar-btn-leave"},{default:t(()=>[a(e(ae),{class:"avatar-bubble",style:ne({background:e(B)})},{default:t(()=>[r(P(e(T)),1)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),a(e(ue),{trigger:"user-avatar-btn-leave","trigger-action":"click"},{default:t(()=>[a(e(R),null,{default:t(()=>[a(e(le),null,{default:t(()=>[a(e(L),{button:"",onClick:e(c)},{default:t(()=>[a(e(oe),{slot:"start",icon:e(se)},null,8,["icon"]),a(e(I),null,{default:t(()=>[...n[6]||(n[6]=[r("Abmelden",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(e(R),{class:"ion-padding"},{default:t(()=>[a(Ie),a(e(re),null,{default:t(()=>[a(e(ie),null,{default:t(()=>[a(e(de),null,{default:t(()=>[...n[7]||(n[7]=[r("Urlaub beantragen",-1)])]),_:1})]),_:1}),a(e(ve),null,{default:t(()=>[a(e(L),null,{default:t(()=>[a(e(I),{position:"stacked"},{default:t(()=>[...n[8]||(n[8]=[r("Von",-1)])]),_:1}),a(e(q),{modelValue:e(o),"onUpdate:modelValue":n[0]||(n[0]=l=>V(o)?o.value=l:null),presentation:"date"},null,8,["modelValue"])]),_:1}),a(e(L),null,{default:t(()=>[a(e(I),{position:"stacked"},{default:t(()=>[...n[9]||(n[9]=[r("Bis",-1)])]),_:1}),a(e(q),{modelValue:e(s),"onUpdate:modelValue":n[1]||(n[1]=l=>V(s)?s.value=l:null),presentation:"date"},null,8,["modelValue"])]),_:1}),a(e(L),null,{default:t(()=>[a(e(I),{position:"stacked"},{default:t(()=>[...n[10]||(n[10]=[r("Urlaubstyp",-1)])]),_:1}),a(e(me),{modelValue:e(d),"onUpdate:modelValue":n[2]||(n[2]=l=>V(d)?d.value=l:null)},{default:t(()=>[(i(!0),m(ye,null,pe(e(g),l=>(i(),D(e(Le),{key:l.id,value:l.name},{default:t(()=>[r(P(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g).length===0?(i(),D(e(L),{key:0},{default:t(()=>[a(e(I),{color:"medium"},{default:t(()=>[e(w)?(i(),m("div",ke," Lade Urlaubstypen… ")):(i(),m("div",Ue,[n[11]||(n[11]=r(" Es sind noch keine Urlaubstypen geladen. ",-1)),n[12]||(n[12]=ge("br",null,null,-1)),e(k)?(i(),m("span",Ce," Tippe auf „Jetzt synchronisieren“, um Urlaubstypen zu laden. ")):(i(),m("span",Ve," Bitte verbinde dich einmal mit dem Internet und tippe auf „Jetzt synchronisieren“, um Urlaubstypen zu laden. "))]))]),_:1})]),_:1})):fe("",!0),a(e(L),null,{default:t(()=>[a(e(I),{position:"stacked"},{default:t(()=>[...n[13]||(n[13]=[r("Kommentar",-1)])]),_:1}),a(e(ce),{modelValue:e(p),"onUpdate:modelValue":n[3]||(n[3]=l=>V(p)?p.value=l:null),"auto-grow":""},null,8,["modelValue"])]),_:1}),a(e(M),{expand:"block",class:"ion-margin-top",disabled:!e(C)||e(v),onClick:e(S)},{default:t(()=>[e(v)?(i(),m("span",Te,"Sende…")):(i(),m("span",Be,"Absenden"))]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),a(e(be),{"is-open":e(_),message:e(y),duration:4e3,onDidDismiss:n[4]||(n[4]=l=>_.value=!1)},null,8,["is-open","message"])]),_:1})]),_:1}))}});export{De as default};
